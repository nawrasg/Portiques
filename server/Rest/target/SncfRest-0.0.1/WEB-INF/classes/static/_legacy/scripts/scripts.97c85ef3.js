"use strict";function updateBatteryDisplay(a){var b=100*a.level,c=$(".battery .battery-level");c.css("width",b+"%"),c.text(b+"%"),a.charging?(c.addClass("charging"),c.removeClass("high"),c.removeClass("medium"),c.removeClass("low")):b>50?(c.addClass("high"),c.removeClass("charging"),c.removeClass("medium"),c.removeClass("low")):b>=25?(c.addClass("medium"),c.removeClass("charging"),c.removeClass("high"),c.removeClass("low")):(c.addClass("low"),c.removeClass("charging"),c.removeClass("high"),c.removeClass("medium"))}function getTrainDetails(a,b){console.log("gettraindetails called"),b.get("http://localhost:8080/sncf/trains/8667").success(function(b,c,d,e){var f=b.nombreBilletsCompostes,g=b.voyageurs,h=b.numeroTrain,i=g-f;console.log("abord: "+f),console.log("vide: "+i),a.numero=h,a.abord=f,a.voyageurs=g,a.data=[f,i]}).error(function(a,b,c,d){console.log(b+" : "+a)})}angular.module("sncfClientApp",[]);var mDisconnectedSocketLabel='<span class="label label-danger" >Non connecté</span>',mConnectedSocketLabel='<span class="label label-success" >Connecté</span>',nApp=angular.module("sncfClientApp",["chart.js","ui.bootstrap","ngSanitize"]);nApp.controller("BrowserAgentController",["$scope",function(a){if(a.alerts=[],is.firefox()){var b=navigator.battery;updateBatteryDisplay(b),b.onchargingchange=function(){updateBatteryDisplay(b)},b.onlevelchange=function(){updateBatteryDisplay(b)}}else a.alerts.push({type:"warning",msg:"Il est conseillé d'utiliser le navigateur Firefox !"});a.closeAlert=function(b){a.alerts.splice(b,1)}}]),nApp.controller("SearchController",["$scope","$http",function(a,b){a.search=function(){waitingDialog.show("Recherche en cours...");var c=$("#txtSearchField").val();b.get("http://localhost:8080/sncf/search/"+c).success(function(b,c,d,e){waitingDialog.hide(),$("#searchDialog").modal({show:"true"}),a.results=b}).error(function(a,b,c,d){console.log(b+" : "+a),waitingDialog.hide()})}}]),nApp.controller("TrainController",["$scope","$http",function(a,b){a.labels=["Voyageurs à bord","Voyageurs à venir"],a.colors=["#FD1F5E","#1EF9A1"],a.options={animateScale:!0,animationEasing:"easeInOutQuart",animationSteps:50},getTrainDetails(a,b),a.change=function(){getTrainDetails(a,b)},$("#status").html(mDisconnectedSocketLabel);var c=null;a.connect=function(){var d=new SockJS("/sncf");c=Stomp.over(d),c.connect({},function(d){console.log("Connected: "+d),$("#status").html(mConnectedSocketLabel),c.subscribe("/topic/update",function(c){var d=JSON.parse(c.body).content;"update"==d&&getTrainDetails(a,b)})})},a.disconnect=function(){null!=c&&(c.disconnect(),$("#status").html(mDisconnectedSocketLabel))},a.send=function(){c.send("/app/hello",{},JSON.stringify({name:"Nawras Le Grand"}))}}]),nApp.controller("SocketController",["$scope","$sce","$http","$rootScope",function(a,b,c,d){}]);var waitingDialog=waitingDialog||function(a){var b=a('<div class="modal fade" data-backdrop="static" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true" style="padding-top:15%; overflow-y:visible;"><div class="modal-dialog modal-m"><div class="modal-content"><div class="modal-header"><h3 style="margin:0;"></h3></div><div class="modal-body"><div class="progress progress-striped active" style="margin-bottom:0;"><div class="progress-bar" style="width: 100%"></div></div></div></div></div></div>');return{show:function(c,d){"undefined"==typeof d&&(d={});var e=a.extend({dialogSize:"m",progressType:""},d);"undefined"==typeof c&&(c="Loading"),b.find(".modal-dialog").attr("class","modal-dialog").addClass("modal-"+e.dialogSize),b.find(".progress-bar").attr("class","progress-bar"),e.progressType&&b.find(".progress-bar").addClass("progress-bar-"+e.progressType),b.find("h3").text(c),b.modal()},hide:function(){b.modal("hide")}}}(jQuery);